<html>
  <head>
    <style>
      /* ================== MARQUEE CONTAINER ================== */
      .marquee {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        display: flex;
        background: #fff;
        z-index: 999999;
        overflow: hidden;
        border-top: 1px solid #c8c8c8;
        will-change: transform;
      }

      .marquee--inner {
        display: flex;
        flex-shrink: 0;
        min-width: 100%;
        animation: marquee 50s linear infinite;
        background: #fff;
      }

      @keyframes marquee {
        0% {
          transform: translateX(0%);
        }
        100% {
          transform: translateX(-100%);
        }
      }

      /* ================== MAIN TICKER BOX ================== */
      .main-container {
        display: flex;
        padding: 5px 0;
        background: #fff;
      }

      .ticker-container {
        display: flex;
        flex-direction: column;
        border-right: 1px solid #ccc;
        padding: 0 10px;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        overflow: hidden;
        width: 360px;
        max-width: 400px;
      }

      .ticker-top {
        padding: 6px 0;
        display: flex;
        justify-content: space-between; /* <-- PRICE ON RIGHT */
        align-items: center;
        width: 100%;
      }

      .tic-con {
        display: flex;
        align-items: center;
      }

      .ticker-content1 {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 5px 0 8px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
      }

      /* ================== FLAGS ================== */
      .circleFlagMain {
        position: relative;
        width: 24px;
        margin-left: 10px;
      }

      .circleFlagMain img {
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        object-fit: cover;
      }

      .circleFlagMain img:first-child {
        top: -16px;
        left: -5px;
        z-index: 1;
      }

      .circleFlagMain img:last-child {
        top: -8px;
        right: 0;
      }

      /* ================== TEXTS ================== */
      .currency {
        font-size: 16px;
        padding: 0 5px;
      }

      .price {
        font-size: 16px;
        font-weight: bold;
        padding-left: 10px;
      }

      .symbol-image {
        width: 18px;
        height: 18px;
        margin: 0 5px;
      }

      .text-tick {
        margin: 0 5px;
        font-weight: 400;
        color: #000;
        font-size: 14px;
      }

      @media (max-width: 600px) {
        .currency,
        .price,
        .text-tick {
          font-size: 13px;
        }
        .ticker-container {
          width: 300px;
        }
      }
    </style>
  </head>

  <body>
    <div class="marquee">
      <div class="marquee--inner">
        <div class="main-container" id="mainContainer"></div>
      </div>
      <div class="marquee--inner">
        <div class="main-container" id="mainContainer1"></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const apiUrl = "https://bottom_ticker.aifaqs.top/api/data";

        async function fetchData() {
          try {
            const res = await fetch(apiUrl, { cache: "no-store" });
            return await res.json();
          } catch (err) {
            console.error("API fetch error:", err);
            return null;
          }
        }

        function createTickerElement(symbolText, price, change) {
          const tickerEl = document.createElement("div");
          tickerEl.className = "ticker-top";

          const matchText = symbolText.match(/[A-Z]{3}\/?[A-Z]{3}/);
          if (!matchText) return tickerEl;

          const cleanSymbol = matchText[0].includes("/")
            ? matchText[0]
            : matchText[0].replace(/([A-Z]{3})([A-Z]{3})/, "$1/$2");

          const [first, second] = cleanSymbol
            .split("/")
            .map((s) => s.toLowerCase());

          const flag1 = `https://fxpricing.com/assets/countries/flags-circle/${first}.svg`;
          const flag2 = `https://fxpricing.com/assets/countries/flags-circle/${second}.svg`;

          let color = "#000";
          if (change && change.startsWith("+")) color = "green";
          if (change && change.startsWith("-")) color = "red";

          tickerEl.innerHTML = `
            <div class="tic-con">
              <div class="circleFlagMain">
                <img src="${flag1}">
                <img src="${flag2}">
              </div>
              <div class="currency">${cleanSymbol}</div>
            </div>

            <div class="price" style="color:${color};">${price || ""}</div>
          `;

          return tickerEl;
        }

        function createMarqueeElement(symbol, value) {
          const marqueeEl = document.createElement("div");
          marqueeEl.className = "ticker-content1";

          const words = value.split(/\s+/);
          const shortText =
            words.length > 5 ? words.slice(0, 6).join(" ") + " ..." : value;

          let imageUrl = "/wp-content/uploads/2025/11/comment.png";
          if (symbol === "short")
            imageUrl = "/wp-content/uploads/2025/11/down.png";
          if (symbol === "long")
            imageUrl = "/wp-content/uploads/2025/11/up.png";

          marqueeEl.innerHTML = `
            <img src="${imageUrl}" class="symbol-image">
            <p class="text-tick">${shortText}</p>
          `;
          return marqueeEl;
        }

        async function updateTickers() {
          const result = await fetchData();
          if (!result) return;

          const api1 = result.api1.response;
          const api2 = result.api2;

          const mc = document.getElementById("mainContainer");
          const mc1 = document.getElementById("mainContainer1");
          mc.innerHTML = "";
          mc1.innerHTML = "";

          api1.forEach((item) => {
            const match = item.value.match(/[A-Z]{3}\/?[A-Z]{3}/);
            if (!match) return;

            const cleanSymbol = match[0].includes("/")
              ? match[0]
              : match[0].replace(/([A-Z]{3})([A-Z]{3})/, "$1/$2");

            const price = api2[cleanSymbol]?.c || "";
            const change = api2[cleanSymbol]?.ch || "";

            const top = createTickerElement(item.value, price, change);
            const msg = createMarqueeElement(item.symbol, item.value);

            const box = document.createElement("div");
            box.className = "ticker-container";
            box.appendChild(top);
            box.appendChild(msg);

            const clone = box.cloneNode(true);
            mc.appendChild(box);
            mc1.appendChild(clone);
          });
        }

        updateTickers();
        setInterval(updateTickers, 60000);
      });
    </script>
  </body>
</html>
